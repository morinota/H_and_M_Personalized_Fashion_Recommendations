# 2022/04/07

- レコメンドを予測するのは、transaction_train.csvの最終週の翌週1週間の各ユーザの購入。
- 予測対象の一週間はどんな季節？
  - =>transaction_train.csvの最終週は2020年9月16～2020年9月22日。
  - よって、予測するのは2020年9月23日～2020年9月29日の7日間。
  - 前年度の同シーズンの売れ筋とか見てもいいかも。
- グルーピング毎に、各レコメンド手法のオフライン精度評価は異なる！
  - 以下は、グルーピング例
  - "sales_channel_id"が「1(オフライン)か2(オンライン)」のどちらが多いか。＝オンラインで購入しがちなユーザか、オフラインで購入しがちなユーザか。
  - アイテムの平均購入金額:
    - 普段高額なアイテムを買ってるユーザに、安いアイテムをレコメンドしても買わないんじゃない？逆もしかりかも。
  - "年齢層"
- レコメンド対象ユーザ164万人のうち、1万人弱、sales_channelがNaNの人がいる。＝＞transaction_train期間(2年間)でアイテム未購入の人は"1万人/164万人"　＝＞全ユーザの1%以下。
- transactionデータを1週間だけ切り取ってみると...
  - ->対象期間の7日間で、購入されたアイテムは19000/105000種類。
  - -> たった一週間だけど、全アイテムのだいたい1/5も買われてるんだ！
- product_codeカラムは、article_id(9桁)を粗くしたモノ(上6桁)。(＝＞同種のアイテムの違う色とかっぽい！)

# 2022/04/07

- ユーザの購買特性や、アイテムの販売トレンドを、時系列のグラフで描画してみる。
  - 若年層のユーザはこの時期にトランザクションが活発になる？
  - このカテゴリのアイテムは、この時期には売れてこの時期には売れなくなる？
- グルーピングのアイデア
  - アクセサリを買う事が多い人か、服を買うことが多い人か、下着を買うことが多い人か、etc.

# 2022/04/09

- 各レコメンド手法の結果をまとめて管理するRecommendResultsクラスを定義する。
  - Validationしやすくなりそう？
  - こういうグルーピングのユーザにはこのレコメンド手法の精度がよさそう！みたいな調査ができそう...!
  - そうすれば、最後のアンサンブルの重み付けの根拠になりそう！(ex. グルーピングで重み付けを変える！)
- ただ、実際に今手元にあるレコメンド結果達は、one-week hold-out validationを考慮した結果ではない(検証用データが学習に使われてる！)
  - なので、実際に検証する際は、one-week hold-out validationを考慮してレコメンド結果を作り直す必要がある。
  - 要するに学習用データをいじって再計算するだけ。
  - ＝＞だから結局、任意の期間の学習データを渡して、各レコメンド手法を実行するコードを書く必要がある！

# 2022/04/10

- Partitioned_validationが思った通りの挙動をしてくれない...
  - One-week holdout関数は上手く機能してる。
  - Datasetオブジェクトも問題なし。
  - Last Purchased Itemsも問題なし。
  - partitioned_validation関数の挙動が異なるみたい...
    - ＝＞map@kとap@kの計算がおかしいっぽい？
    - もしくはその下の処理？
  - ＝＞何が間違ってたのかまだ分かってないけど、とりあえず見本のNotebookの関数をとってきて、何とかパイプラインが正しい評価値を出せるようになった！
- 以降は、色んなレコメンド手法やグルーピング毎のValidationを進めていく！

# 2022/04/14

    - Google Drive以下のval_results_csvに検証用のレコメンド結果を保存していく。
      - last purchased items
      - TimeDecayingPopularity
      - Time is our best friend
      - Rule based by customer age
      - Trending Product
      - Implicit ALS
      - Byfone approach
      - Chris approach
      - Byfone and Chris combination
      - LSTM_item_features
      - SVD reRanking 

# 2022/04/16
- 検証用データをまとめるクラスを定義する?
  - 検証用データが格納されたフォルダを指定して、globとか使う？
  - ファイル名＝＞アプローチ名を取得？

# 2022/04/17
- Discussionをチェック
  - **２がオンラインで、1は店舗！**

# 2022/04/19
- 画像データを使ったレコメンド！
- まず画像特徴量を取得＝＞ResNet18を使ってEncode！
- 続いてコサイン類似度に基づいて、k-NNで、各アイテムの近傍アイテムと類似度を取得！
  - ＝＞全アイテムやろうとすると、10時間くらいかかりそう！
  - ＝＞このプロセスは、トランザクションデータのない新規アイテムだけで試す！
- 学習データをオフラインのトランザクションだけに絞れば、もう少し改善される？
